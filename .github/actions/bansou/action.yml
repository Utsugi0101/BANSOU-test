name: "BANSOU PR Gate"
description: "Validate BANSOU attestation JWTs in PRs"
author: "bansou-dev"
branding:
  icon: "lock"
  color: "orange"
inputs:
  issuer:
    description: "Expected JWT issuer"
    required: true
  jwks_url:
    description: "JWKS URL for signature verification"
    required: true
  required_quiz_id:
    description: "Required quiz_id to pass the gate"
    required: true
  attestations_dir:
    description: "Directory containing attestation JWTs"
    required: false
    default: ".bansou/attestations"
  fail_on_missing:
    description: "Fail if no attestation files are found"
    required: false
    default: "true"
  head_sha:
    description: "PR head SHA to verify against"
    required: false
  pr_author:
    description: "PR author to verify against"
    required: false
  repo:
    description: "Repository full name (owner/repo) to verify against"
    required: false
runs:
  using: "composite"
  steps:
    - uses: actions/setup-node@v4
      with:
        node-version: "20"
    - name: Install dependencies
      run: npm ci --omit=dev --prefix "${{ github.action_path }}"
      shell: bash
    - name: Verify BANSOU attestation
      run: node "${{ github.action_path }}/dist/index.js"
      shell: bash
      env:
        INPUT_ISSUER: ${{ inputs.issuer }}
        INPUT_JWKS_URL: ${{ inputs.jwks_url }}
        INPUT_REQUIRED_QUIZ_ID: ${{ inputs.required_quiz_id }}
        INPUT_ATTESTATIONS_DIR: ${{ inputs.attestations_dir }}
        INPUT_FAIL_ON_MISSING: ${{ inputs.fail_on_missing }}
        INPUT_HEAD_SHA: ${{ inputs.head_sha }}
        INPUT_PR_AUTHOR: ${{ inputs.pr_author }}
        INPUT_REPO: ${{ inputs.repo }}
